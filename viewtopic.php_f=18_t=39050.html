<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>


<style type="text/css">
#global { width: 100%; }
</style>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />


<title>Lancers Reactor Forums &bull; View topic - Berths, Docking Behavior, Etc.</title>

<link href="./styles/ca_orbital/theme/stylesheet.css" rel="stylesheet" type="text/css" media="screen, projection" />
<link media="only screen and (max-device-width: 480px)" href="./styles/ca_orbital/theme/iphone.css" type="text/css" rel="stylesheet" />

</head>

<body id="phpbb" class="section- ltr">
<div id="main">

<p class="top"><a id="top" name="top" accesskey="t"></a></p>

<div id="global" style="margin: 0 auto;">

    <p class="skiplink"><a href="#start_here">Skip to content</a></p>

	<!-- header start -->
    <div id="topnav">
        <div class="left"></div>
        <div class="right"></div>
        <ul class="linklist topnav leftside">
            <li>
                <a href="https://the-starport.com" title="The Starport">The Starport</a>
            </li>
            <li>
                <span>&bull;</span>
                <a href="https://the-starport.net/discord" title="The Starport Discord">Discord</a>
            </li>
        </ul>
    </div>
    

	<div id="logo"><a href="./index.php.html"><img src="./styles/ca_orbital/imageset/tlr_logo.png" alt="" title=""><span>Lancers Reactor Forums</span></a></div>
	<!-- header end -->

    <div id="page-header-msg">
		<div class="block-header"><span></span><div></div></div>
       <div class="block-content"><div class="block-inner"><div class="block-inner2">
            	
		<table width="100%">
			<tbody><tr><td style="text-align:center;width:100%;">

            <h2 style="color:red;">Important Message</h2>
            <h3>You are browsing the archived Lancers Reactor forums. You cannot register or login.<br>
            The content may be outdated and links may not be functional.</h3><br>
            <h4>To get the latest in Freelancer news, mods, modding and downloads, go to<br>
            	<a href="https://the-starport.com">The-Starport</a></h4>
    	</td></tr> 
    </tbody></table>
    
    	</div></div></div>
    <div class="block-footer"><span></span><div></div></div>
	</div>
    <p></p>
	<div id="page-header">
		<div class="navbar navbar-top" id="navbar-top">
            <div class="block-header"><span></span><div></div></div>
            <div class="block-content"><div class="block-inner"><div class="block-inner2">
            <ul class="linklist navlinks">
                <li class="icon-home"><span class="home-extra"><a href="./index.php.html" accesskey="h">Board index</a>  <strong>&#8249;</strong> <a href="./viewforum.php_f=75.html">Freelancer Editing</a> <strong>&#8249;</strong> </span><a href="./viewforum.php_f=18.html">Freelancer General Editing Forum</a></li>
            </ul>
            <div class="block-clear"></div>
            </div></div></div>
            <div class="block-footer"><span></span><div></div></div>
		</div>
	</div>
    <p></p>

	<a name="start_here"></a>

	<div id="page-body">
		<div id="content-start"></div>
<h2 class="leftside"><a href="./viewtopic.php_f=18_t=39050" id="topic-title">Berths, Docking Behavior, Etc.</a></h2>

<p class="rightside">
    
</p>
<div class="clear"></div>
<p class="forum-desc">The general place to discuss MOD''ing Freelancer! </p>

<div class="topic-actions">

	<div class="buttons">
	
		<div class="reply-icon"><a href="" title="Post a reply"><span></span>Post a reply</a></div>
	
	</div>

	
		<div class="pagination">
			7 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
	

</div>
<div class="clear"></div>


	<div id="p29472" class="post">
		<div class="block-border block-block block-post block-post-first"><div class="block-header"><span></span><div></div></div><div class="block-content"><div class="block-inner"><div class="block-inner2">
        <div class="post-maximize" style="display: none;"></div>
        <div class="post-profile-block">
        <div class="profile-block">
        <div class="postprofile">
            <div class="profile-top">
                <p class="profile-author">
                    <a class="profile-link popup-link" id="popup-link-0" href="javascript:void(0);">Argh</a>
                </p>
                
            </div>
            

            <div class="profile-details">
                
            </div>
		</div>
		</div>
		</div>
		

        
		<div class="postbody">
		    <div class="post-content">
			

			<p class="author"><a href=""><img src="./styles/ca_orbital/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a> Thu May 19, 2005 2:49 pm <span class="post-author-inline" style="display: none;">by Argh</span></p>

			<h3 class="first"><a href="#p29472" class="post-subject">Berths, Docking Behavior, Etc.</a></h3>

			

			<div class="content">Ok... I have successfully gotten every single docking point in FL to be usable by players and NPCs.
<br />
<br />I couldn't get Moors working entirely to my satisfaction- the Mooring code is apparantly broken, and will not properly end with a fade-to-black transition to the Room/Transition scripts of Bases.  We don't see this, because player-piloted ships can't use Moors.  NPC ships that use Moors, moreover, use special, hard-coded behaviors that cause them to approach the Moor, reach the HpDockMount, and then reverse and seek a new Waypoint.
<br />
<br />So I reversed this, got rid of every single Moor in the game, and then converted every ship that uses Moors to use Docks, with a gentle increase in the docking_spheres for everything, and with some modifications to the most troublesome HpDockMount and HpDockPoint entries in several CMPs.
<br />
<br />The results are quite neat, so I thought I'd share this.  It'll be in the next version of the XML Toolkit mod, so you can &quot;steal&quot; it directly, but I suspect that people will want to understand the theory behind it.
<br />
<br />Basically put... FL uses the HpMounts to determine a host of behaviors, in lieu of the centerpoints of the CMPs and SURs normally used by the game engine.
<br />
<br />HpMounts are used to determine the following things:
<br />
<br />1.  They are the point that must intersect a docking_sphere in order to complete a Berthing sequence.
<br />
<br />2.  They are the point used to determine the position of a ship CMP in any THN Scene.
<br />
<br />3.  They are used to offset the model when undocking from Stations, Bases, and other dockable locations.
<br />
<br />As a result of this understanding, based upon several experiments, I think that my current solution could be improved.  For example, there are some notable issues with large ships:
<br />
<br />1.  You have to move the HpDockMounts out quite a ways from Stations, or offset the ships' HpMounts so that they're far below the ship's centerpoint, so that they appear &quot;above&quot; the object they're un-docking from.
<br />
<br />2.  Because docking and un-docking reverse the position on the Z-axis of the game objects effected, it would be wise to have all HpDockMounts positioned so that they are as far away from the Dockable as the midpoint of the longest vessel in your mod.  Otherwise, with certain geometries, it's quite possible that you will see ships spawning with some of their geometry intersecting the objects they're un-docking from <img src=smilies/icon_smile_tongue.gif width=15 height=15 border=0 align=middle>
<br />
<br />3.  While putting the HpMounts significantly ahead of the ships decreases their problems with docking, it increases the problems outlined in (2), above.  We should put HpMounts close to the true centers of our objects on the Z axis, 0 on the X, and position Y so that large things aren't buried in the &quot;ground&quot; in THN Scenes, nor appear inside of Dockables.
<br />
<br />Lastly, I have done some physics hacking, and I think that I have arrived at the lowest stable steering values that should be used for ships that will be flown by NPCs.  If you are careful about the AI you assign to these ships, their flight will look very natural, because of the damping effects caused by in the increased inertial values:
<br />
<br />SHIP
<br />
<br />linear_drag = 1
<br />mass = 1000
<br />steering_torque = 350000000, 350000000, 150000000
<br />angular_drag = 1000000000, 1000000000, 1000000000
<br />rotation_inertia = 300000000, 300000000, 300000000
<br />nudge_force = 150000
<br />strafe_force = 50000
<br />
<br />ENGINE
<br />
<br />linear_drag = 10000
<br />max_force = 800000
<br />
<br />Note that linear_drag counteracts Mass exceedingly quickly.  This does mean that these ships accelerate and decelerate on a dime.  This is masked with the rotation_interia values, however, which make spin acceleration quite slow, plus the  low rate of top spin speed.  
<br />
<br />The nudge_force ratio to linear_drag is as high as it is because the Docking AI really demands it.  FL's docking AI is about as smart as a drunken cockroach- it basically picks an approach, and if it runs into anything, it will make either a right or left-hand turn, do a full 360 at speed, and re-approach, using nudge_force to align itself.  You don't want it any lower than 15M/S, even though this will occasionally result in odd behavior- FL's own defaults were similar.
<br />
<br />Also note that the Z-axis torque is lower than the other values- this is to prevent ships from exhibiting bizarre-looking barrel-rolls, which look perfectly-reasonable with fighters but look silly with capships <img src="./images/smilies/icon_wink.gif" alt=";-)" title="Wink" />
<br />
<br />At any rate, I know that most of this has been explained in one place or another before, but I decided to do a lot've experiments, and I'm satisfied that these values are about as low as you can go before NPC ships will start having problems.  With these super-stiff steering values, large ships will act like they're large ships if collided with- ships with smaller values with spin and vector away from the impacts, but the large ships will continue on their way, as if they weighed millions of tons <img src=smilies/icon_smile.gif width=15 height=15 border=0 align=middle></div>

			
            </div>

		
            <ul class="profile-icons">
        		<li class="top-icon"><a href="#top" class="top" title="Top"><span>Top</span></a></li>
                
            </ul>
		

            <div class="clear"></div>
		</div>

        

		<div class="block-clear"></div></div></div></div><div class="block-footer"><span></span><div></div></div></div>
	</div>


	<div id="p368041" class="post">
		<div class="block-border block-block block-post"><div class="block-header"><span></span><div></div></div><div class="block-content"><div class="block-inner"><div class="block-inner2">
        <div class="post-maximize" style="display: none;"></div>
        <div class="post-profile-block">
        <div class="profile-block">
        <div class="postprofile">
            <div class="profile-top">
                <p class="profile-author">
                    <a class="profile-link popup-link" id="popup-link-1" href="javascript:void(0);">Cold_Void</a>
                </p>
                
            </div>
            

            <div class="profile-details">
                
            </div>
		</div>
		</div>
		</div>
		

        
		<div class="postbody">
		    <div class="post-content">
			

			<p class="author"><a href=""><img src="./styles/ca_orbital/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a> Fri May 20, 2005 5:02 am <span class="post-author-inline" style="display: none;">by Cold_Void</span></p>

			<h3><a href="#p368041" class="post-subject"></a></h3>

			

			<div class="content">Argh i have gotten moors to work fully, e.g. you command the ship to dock and the station says 'proceed to moor #' as it does for npc's,when you unmoor you start facing towards the station,controller says 'disengaging mooring link' and the ship backs up to HpMountA02 performing a 90 degree turn. I got these results by doing this:
<br />
<br />set your mooring point as the first in the docking sphere entries, second comes its jump hardpoint - *this is the critical part* with the two hardpoints occupying the same place make the moor sphere large(this tells it you're close enough to start the sequence,i think)and the jump just large enough to intersect with spconnect.voila thats it - now your ship will drive right up to the mooring point and when it enters the jump sphere it will land(i don't remember if theres a fade sorry).your ship will unmoor from the first dock point in the solar, the moor you made,you can add as many moors as you want but theres not much point since you'll never leave from them only #1. also if you add a dock after it the controller will always call it dock 2,3,etc,however many entries there are before the dock.
<br />
<br />unfort it doesn't sound like you've solved the always-launches-from-dock-1 bug(well actually an oversight i think)which makes it absolutely pointless to mix docks and moors because a docking fighter will leave the moor,unless its a dock in which case unmooring freighters are now leaving from a dock &lt;_&lt;
<br />
<br />Edited by - Cold_Void on 5/20/2005 6:18:42 AM</div>

			
            </div>

		
            <ul class="profile-icons">
        		<li class="top-icon"><a href="#top" class="top" title="Top"><span>Top</span></a></li>
                
            </ul>
		

            <div class="clear"></div>
		</div>

        

		<div class="block-clear"></div></div></div></div><div class="block-footer"><span></span><div></div></div></div>
	</div>


	<div id="p368048" class="post">
		<div class="block-border block-block block-post"><div class="block-header"><span></span><div></div></div><div class="block-content"><div class="block-inner"><div class="block-inner2">
        <div class="post-maximize" style="display: none;"></div>
        <div class="post-profile-block">
        <div class="profile-block">
        <div class="postprofile">
            <div class="profile-top">
                <p class="profile-author">
                    <a class="profile-link popup-link" id="popup-link-2" href="javascript:void(0);">Black Eagle</a>
                </p>
                
            </div>
            

            <div class="profile-details">
                
            </div>
		</div>
		</div>
		</div>
		

        
		<div class="postbody">
		    <div class="post-content">
			

			<p class="author"><a href=""><img src="./styles/ca_orbital/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a> Fri May 20, 2005 6:29 am <span class="post-author-inline" style="display: none;">by Black Eagle</span></p>

			<h3><a href="#p368048" class="post-subject"></a></h3>

			

			<div class="content">Hi!
<br />
<br />Cold_Void: Do you still have the code and could you post it here. I'm also working on getting mooring to work and until now was not successful. As good as I understand, I did nearly the same as you, but it does not work. So, could you post your code here? This would be very helpful and of course I will give you credit, if it solves my problems.
<br />
<br />Thanks!
<br />
<br />Black Eagle</div>

			
            </div>

		
            <ul class="profile-icons">
        		<li class="top-icon"><a href="#top" class="top" title="Top"><span>Top</span></a></li>
                
            </ul>
		

            <div class="clear"></div>
		</div>

        

		<div class="block-clear"></div></div></div></div><div class="block-footer"><span></span><div></div></div></div>
	</div>


	<div id="p368067" class="post">
		<div class="block-border block-block block-post"><div class="block-header"><span></span><div></div></div><div class="block-content"><div class="block-inner"><div class="block-inner2">
        <div class="post-maximize" style="display: none;"></div>
        <div class="post-profile-block">
        <div class="profile-block">
        <div class="postprofile">
            <div class="profile-top">
                <p class="profile-author">
                    <a class="profile-link popup-link" id="popup-link-3" href="javascript:void(0);">Argh</a>
                </p>
                
            </div>
            

            <div class="profile-details">
                
            </div>
		</div>
		</div>
		</div>
		

        
		<div class="postbody">
		    <div class="post-content">
			

			<p class="author"><a href=""><img src="./styles/ca_orbital/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a> Fri May 20, 2005 12:08 pm <span class="post-author-inline" style="display: none;">by Argh</span></p>

			<h3><a href="#p368067" class="post-subject"></a></h3>

			

			<div class="content">Hey, thanks Cold_Void... Chips will probably read that and give Mooring another whirl.  For myself, after correcting the Docking issue with Berths... I'm pretty tempted to make HpDockMountA (etc.) in a &quot;safe position&quot;, so that egress from the Bases works even for very large ships.  I thought it was HpDockMountB, like with Gates, but if you say it's A... well, that's easy to test <img src=smilies/icon_smile.gif width=15 height=15 border=0 align=middle>
<br />
<br />I really like what I'm seeing after converting everything over to Berths, actually.  It makes NPC ships land on a lot more stuff, and makes player landing on Bases more interesting, and while the ships disappear when they finish the sequence, it's not terribly noticable, because I've gotten the docking_spheres set up so that it only happens as they get fairly close to the docking bay doors.  So, with small ships at least, you hardly even notice.  Now that you've shared that important point about where player ships undock from, I can even see doing some Hardpoint manipulation on all of the Dockables to ensure smooth operation for players, even in gigantic capships... which would be nice, since in the next version of the Toolkit, every single ship from FL's files will be flyable <img src=smilies/icon_smile.gif width=15 height=15 border=0 align=middle></div>

			
            </div>

		
            <ul class="profile-icons">
        		<li class="top-icon"><a href="#top" class="top" title="Top"><span>Top</span></a></li>
                
            </ul>
		

            <div class="clear"></div>
		</div>

        

		<div class="block-clear"></div></div></div></div><div class="block-footer"><span></span><div></div></div></div>
	</div>


	<div id="p368454" class="post">
		<div class="block-border block-block block-post"><div class="block-header"><span></span><div></div></div><div class="block-content"><div class="block-inner"><div class="block-inner2">
        <div class="post-maximize" style="display: none;"></div>
        <div class="post-profile-block">
        <div class="profile-block">
        <div class="postprofile">
            <div class="profile-top">
                <p class="profile-author">
                    <a class="profile-link popup-link" id="popup-link-4" href="javascript:void(0);">Coolbeano</a>
                </p>
                
            </div>
            

            <div class="profile-details">
                
            </div>
		</div>
		</div>
		</div>
		

        
		<div class="postbody">
		    <div class="post-content">
			

			<p class="author"><a href=""><img src="./styles/ca_orbital/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a> Tue May 24, 2005 2:41 am <span class="post-author-inline" style="display: none;">by Coolbeano</span></p>

			<h3><a href="#p368454" class="post-subject"></a></h3>

			

			<div class="content">with of course the lifeboat, no?</div>

			
            </div>

		
            <ul class="profile-icons">
        		<li class="top-icon"><a href="#top" class="top" title="Top"><span>Top</span></a></li>
                
            </ul>
		

            <div class="clear"></div>
		</div>

        

		<div class="block-clear"></div></div></div></div><div class="block-footer"><span></span><div></div></div></div>
	</div>


	<div id="p395334" class="post">
		<div class="block-border block-block block-post"><div class="block-header"><span></span><div></div></div><div class="block-content"><div class="block-inner"><div class="block-inner2">
        <div class="post-maximize" style="display: none;"></div>
        <div class="post-profile-block">
        <div class="profile-block">
        <div class="postprofile">
            <div class="profile-top">
                <p class="profile-author">
                    <a class="profile-link popup-link" id="popup-link-5" href="javascript:void(0);">w0dk4</a>
                </p>
                
            </div>
            

            <div class="profile-details">
                
            </div>
		</div>
		</div>
		</div>
		

        
		<div class="postbody">
		    <div class="post-content">
			

			<p class="author"><a href=""><img src="./styles/ca_orbital/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a> Sun Jan 01, 2006 1:16 pm <span class="post-author-inline" style="display: none;">by w0dk4</span></p>

			<h3><a href="#p395334" class="post-subject"></a></h3>

			

			<div class="content">Cold_Void your idea does not work for me...
<br />
<br />What spconnect hardpoint are you referencing?
<br />and when i put it like this:
<br />
<br />docking_sphere = moor_medium, HpDockMountI, 50.000000
<br />docking_sphere = jump, HpDockMountI, 10.000000
<br />docking_sphere = berth, HpDockMountA, 2.500000, Sc_open dock1
<br />docking_sphere = berth, HpDockMountB, 2.500000, Sc_open dock2
<br />
<br />the whole station gets bugged and you can dock with your can_use_medium_moors on every dock and the &quot;moor&quot; on HpDockMountI ist not called like a moor, its called like a jump (&quot;Request granted, proceed to five&quot;..)</div>

			
            </div>

		
            <ul class="profile-icons">
        		<li class="top-icon"><a href="#top" class="top" title="Top"><span>Top</span></a></li>
                
            </ul>
		

            <div class="clear"></div>
		</div>

        

		<div class="block-clear"></div></div></div></div><div class="block-footer"><span></span><div></div></div></div>
	</div>


	<div id="p395414" class="post">
		<div class="block-border block-block block-post"><div class="block-header"><span></span><div></div></div><div class="block-content"><div class="block-inner"><div class="block-inner2">
        <div class="post-maximize" style="display: none;"></div>
        <div class="post-profile-block">
        <div class="profile-block">
        <div class="postprofile">
            <div class="profile-top">
                <p class="profile-author">
                    <a class="profile-link popup-link" id="popup-link-6" href="javascript:void(0);">Cold_Void</a>
                </p>
                
            </div>
            

            <div class="profile-details">
                
            </div>
		</div>
		</div>
		</div>
		

        
		<div class="postbody">
		    <div class="post-content">
			

			<p class="author"><a href=""><img src="./styles/ca_orbital/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a> Mon Jan 02, 2006 9:58 am <span class="post-author-inline" style="display: none;">by Cold_Void</span></p>

			<h3><a href="#p395414" class="post-subject"></a></h3>

			

			<div class="content">that was a mistake on my part, HpMount as Argh has said,is the ships docking point that tells it when to engage cutscenes and the rest of docking.
<br />
<br />docking_sphere = moor_medium, HpDockMountI, 50.000000
<br />docking_sphere = jump, HpDockMountI, 10.000000
<br />
<br />instead of that it should be
<br />docking_sphere = moor_medium, HpDockMountA, 50.000000
<br />docking_sphere = jump, HpDockPointA02, 10.000000
<br />or
<br />
<br />docking_sphere = moor_medium, HpDockMountA, 50.000000
<br />docking_sphere = jump, HpDockMountB, 10.000000
<br />
<br />it has been a long time since i had this working,however it *does* work when its executed perfectly(the experiments i was working with were lost sadly,and a lot of my random tests were based on orientations of hardpoints - let me recommend using a clean slate for your test case,and lay out your docking points as revolutes so you can read their orientation easily)
<br />
<br />needless to say HpMount(not spconnect) needs to be on the front of the ship to intersect the jump sphere
<br />
<br />sorry my info is so bad,but scouts honor it worked(imperfectly)with the only drawback being that you undock at the first dock sphere no matter what</div>

			
            </div>

		
            <ul class="profile-icons">
        		<li class="top-icon"><a href="#top" class="top" title="Top"><span>Top</span></a></li>
                
            </ul>
		

            <div class="clear"></div>
		</div>

        

		<div class="block-clear"></div></div></div></div><div class="block-footer"><span></span><div></div></div></div>
	</div>



<div class="topic-actions">
	<div class="buttons" id="viewtopic-buttons">
	
		<div class="reply-icon"><a href="" title="Post a reply"><span></span>Post a reply</a></div>
	
	</div>

	
		<div class="pagination">
			7 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
	
</div>


	<p></p><p><a href="./viewforum.php_f=18" class="left-box left" accesskey="r">Return to Freelancer General Editing Forum</a></p>

	<br /><br />
</div>

<div>
	<a id="bottom" name="bottom" accesskey="z"></a>
</div>

	<div id="footer-clear">&nbsp;</div>
	<div class="copyright">
        <br />Hosted by <a href="https://the-starport.com">The Starport</a> &bull; Theme by <a href="https://www.stsoftware.biz/" ref="nofollow">ST Software</a>
	</div>


</div><!-- #global -->

</div>
</body>
</html>